# Testing Guide - CRM Relay with React UIs

**Date**: February 19, 2026
**Commit**: ad56585

---

## Overview

This guide will help you test the newly implemented React UIs for the CRM Relay system. The update includes two full-featured frontends (server-ui and client-ui) with JWT authentication, path-based webhook routing, and dynamic configuration management.

---

## Quick Start

### Option 1: Using Docker Compose (Recommended)

```bash
# Clone the repository
git clone https://github.com/QuantumSolver/crm-relay.git
cd crm-relay

# Start all services
docker-compose up -d

# View logs
docker-compose logs -f
```

### Option 2: Using Separate Docker Compose Files

```bash
# Start server (Redis + Relay Server)
docker-compose -f docker-compose.server.yml up -d

# Start client (Relay Client)
docker-compose -f docker-compose.client.yml up -d

# View server logs
docker-compose -f docker-compose.server.yml logs -f relay-server

# View client logs
docker-compose -f docker-compose.client.yml logs -f relay-client
```

### Option 3: Local Development

```bash
# Install dependencies
go mod download

# Build everything
make build

# Start Redis (if not running)
docker run -d -p 6379:6379 redis:7-alpine

# Start server
./bin/relay-server

# In another terminal, start client
./bin/relay-client
```

---

## Accessing the UIs

### Server UI
- **URL**: http://localhost:8080
- **Features**:
  - Dashboard with real-time metrics
  - API key management
  - Webhook endpoint configuration
  - Path-based webhook routing

### Client UI
- **URL**: http://localhost:8081
- **Features**:
  - Dashboard with real-time metrics
  - Local endpoint configuration
  - Retry settings management
  - Dead letter queue viewer

---

## Default Credentials

On first startup, the system will auto-generate default admin credentials and log them to the console. Check the logs for:

```
Default admin credentials:
Username: admin
Password: <auto-generated-password>
```

**Important**: For production, set these environment variables:
- `JWT_SECRET` - Your JWT signing secret
- `ADMIN_USERNAME` - Your admin username
- `ADMIN_PASSWORD` - Your admin password

---

## Testing Workflow

### 1. Test Server UI

#### Step 1: Login
1. Navigate to http://localhost:8080
2. Enter the default admin credentials (from logs)
3. Click "Login"

#### Step 2: View Dashboard
1. You should see the dashboard with metrics cards
2. Metrics should auto-refresh every 5 seconds
3. Verify all metrics are displayed correctly

#### Step 3: Create API Key
1. Navigate to "API Keys" from the navigation
2. Click "Create API Key"
3. Enter a name (e.g., "Meta Platform")
4. Select a platform (e.g., "meta")
5. Click "Create"
6. Copy the generated API key

#### Step 4: Create Webhook Endpoint
1. Navigate to "Endpoints" from the navigation
2. Click "Create Endpoint"
3. Enter:
   - Platform: "meta"
   - Path: "/webhook/meta"
   - HTTP Method: "POST"
   - Target URL: "http://localhost:3000/webhook"
4. Click "Create"

#### Step 5: Test Webhook
```bash
# Send a test webhook
curl -X POST http://localhost:8080/webhook/meta \
  -H "Content-Type: application/json" \
  -H "X-API-Key: <your-api-key>" \
  -d '{"test": "data"}'
```

### 2. Test Client UI

#### Step 1: Login
1. Navigate to http://localhost:8081
2. Enter the default admin credentials (same as server)
3. Click "Login"

#### Step 2: View Dashboard
1. You should see the dashboard with metrics cards
2. Metrics should auto-refresh every 5 seconds
3. Verify all metrics are displayed correctly

#### Step 3: Configure Local Endpoint
1. Navigate to "Config" from the navigation
2. Enter your local webhook URL (e.g., "http://localhost:3000/webhook")
3. Click "Test Connectivity" to verify the endpoint is reachable
4. Click "Save Configuration"

#### Step 4: Configure Retry Settings
1. Navigate to "Retry Config" from the navigation
2. Adjust retry settings:
   - Max Retries: 3
   - Initial Retry Delay: 1000ms
   - Backoff Multiplier: 2.0
3. View the retry schedule preview
4. Click "Save Configuration"

#### Step 5: View Dead Letter Queue
1. Navigate to "DLQ" from the navigation
2. If there are failed messages, you can:
   - View message details
   - Replay individual messages
   - Delete messages
   - Bulk replay all messages

---

## Testing Path-Based Routing

### Setup
1. Create API keys for different platforms (e.g., "meta", "slack", "teams")
2. Create webhook endpoints for each platform with different paths

### Test
```bash
# Test Meta webhook
curl -X POST http://localhost:8080/webhook/meta \
  -H "Content-Type: application/json" \
  -H "X-API-Key: <meta-api-key>" \
  -d '{"platform": "meta", "data": "test"}'

# Test Slack webhook
curl -X POST http://localhost:8080/webhook/slack \
  -H "Content-Type: application/json" \
  -H "X-API-Key: <slack-api-key>" \
  -d '{"platform": "slack", "data": "test"}'

# Test Teams webhook
curl -X POST http://localhost:8080/webhook/teams \
  -H "Content-Type: application/json" \
  -H "X-API-Key: <teams-api-key>" \
  -d '{"platform": "teams", "data": "test"}'
```

### Verify
1. Check server logs to confirm webhooks are received
2. Check client logs to confirm webhooks are processed
3. View metrics in both UIs to see the counts increase

---

## Testing DLQ Functionality

### Simulate Failed Webhook
1. Configure the client with an invalid endpoint URL
2. Send a test webhook
3. The webhook should fail and be added to the DLQ

### Replay Failed Message
1. Navigate to the Client UI DLQ page
2. Find the failed message
3. Click "View" to see the message details
4. Fix the endpoint configuration
5. Click "Replay" to retry the message
6. Verify the message is processed successfully

---

## Environment Variables

### Required for Production
```bash
# JWT Authentication
JWT_SECRET=your-secret-jwt-key-change-this
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your-secure-password
JWT_EXPIRATION=24h

# Redis
REDIS_URL=redis:6379
REDIS_PASSWORD=your-redis-password

# Stream Configuration
STREAM_NAME=webhook-stream
CONSUMER_GROUP=relay-group
CONSUMER_NAME=relay-client
DEAD_LETTER_QUEUE=webhook-dlq
```

### Optional
```bash
# Retry Configuration
MAX_RETRIES=3
RETRY_DELAY=1000
RETRY_MULTIPLIER=2.0

# Health Check
HEALTH_CHECK_INTERVAL=30
```

---

## Troubleshooting

### UI Not Loading
- Check if the service is running: `docker-compose ps`
- Check logs: `docker-compose logs -f relay-server` or `docker-compose logs -f relay-client`
- Verify ports are not in use: `netstat -tulpn | grep 8080` or `netstat -tulpn | grep 8081`

### Login Fails
- Check logs for default credentials
- Verify JWT_SECRET is set (if using custom credentials)
- Clear browser cache and cookies

### Webhook Not Received
- Verify API key is correct
- Check webhook path matches endpoint configuration
- Check server logs for errors
- Verify Redis is running

### Webhook Not Processed
- Check client logs for errors
- Verify local endpoint URL is correct
- Test endpoint connectivity from Client UI
- Check DLQ for failed messages

### Metrics Not Updating
- Wait 5 seconds for auto-refresh
- Check if services are running
- Verify Redis connection
- Check browser console for errors

---

## Docker Commands

### View Logs
```bash
# All services
docker-compose logs -f

# Server only
docker-compose logs -f relay-server

# Client only
docker-compose logs -f relay-client

# Redis only
docker-compose logs -f redis
```

### Restart Services
```bash
# All services
docker-compose restart

# Specific service
docker-compose restart relay-server
docker-compose restart relay-client
```

### Stop Services
```bash
# All services
docker-compose down

# With volumes
docker-compose down -v
```

### Rebuild Services
```bash
# Rebuild and restart
docker-compose up -d --build

# Rebuild specific service
docker-compose up -d --build relay-server
```

---

## Performance Testing

### Load Testing with Apache Bench
```bash
# Install ab
sudo apt-get install apache2-utils

# Test webhook endpoint
ab -n 1000 -c 10 -p payload.json -T application/json \
  -H "X-API-Key: <your-api-key>" \
  http://localhost:8080/webhook/meta
```

### Monitor Metrics
1. Watch the dashboard in real-time
2. Check queue depth and pending messages
3. Monitor DLQ for failed messages
4. Check average latency

---

## Security Testing

### Test Authentication
1. Try accessing protected routes without login (should redirect to login)
2. Try accessing with invalid credentials (should show error)
3. Test token expiration (wait 24h or set JWT_EXPIRATION to a short duration)

### Test API Key Validation
1. Send webhook without API key (should fail)
2. Send webhook with invalid API key (should fail)
3. Send webhook with correct API key (should succeed)

### Test CORS
1. Try accessing UI from different origin
2. Verify CORS headers are set correctly

---

## Next Steps

After successful testing:

1. **Set Production Credentials**
   - Generate strong JWT_SECRET
   - Set secure ADMIN_PASSWORD
   - Configure REDIS_PASSWORD

2. **Configure HTTPS**
   - Set up reverse proxy (nginx, traefik)
   - Configure SSL certificates
   - Update CORS settings

3. **Set Up Monitoring**
   - Configure Prometheus metrics
   - Set up alerting
   - Monitor health checks

4. **Scale Deployment**
   - Use Docker Swarm or Kubernetes
   - Configure load balancer
   - Set up Redis cluster

---

## Documentation

- [README.md](README.md) - Main project documentation
- [QUICKSTART.md](QUICKSTART.md) - Quick start guide
- [TODO.md](TODO.md) - Task tracking
- [PROGRESS_SUMMARY.md](PROGRESS_SUMMARY.md) - Implementation status
- [CLIENT_UI_COMPLETION.md](CLIENT_UI_COMPLETION.md) - Client UI completion notes

---

## Support

If you encounter any issues:

1. Check the logs: `docker-compose logs -f`
2. Review this testing guide
3. Check the documentation
4. Open an issue on GitHub: https://github.com/QuantumSolver/crm-relay/issues

---

**Last Updated**: February 19, 2026
**Status**: Ready for testing
